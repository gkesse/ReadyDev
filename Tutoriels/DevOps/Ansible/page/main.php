<div class="Parallax GParallax1"><div class="Img Binary"><div class="Caption"><a href="#"><div class="Text">Gestion de configurations avec Ansible<br></div></a></div></div><div class="Body2 Orange"><br>Le but de ce tutoriel est de vous apprendre la gestion de configurations avec <b>Ansible</b>.<br>Produit par <b>Gérard KESSE</b>.<br><br><div class="Content0 GSummary1"><div class="Item4"><span class="Icon10 fa fa-book"></span><a class="Link4" href="#Introduction">Introduction</a></div><div class="Item4"><span class="Icon10 fa fa-book"></span><a class="Link4" href="#Fondamentaux">Fondamentaux</a></div></div><br></div></div><br><div class="Content2 GTitle1"><div class="MainBlock2"><div class="Content"><h1 class="Title2 Center" id="Introduction"><a class="Link3" href="#">Introduction</a></h1><div class="Body3"><br><b>Ansible </b>est un outil de gestion automatique de configurations.<br><br><div class="Img3 GImage"><img src="/Tutoriels/DevOps/Ansible/img/b_ansible.png" alt="/Tutoriels/DevOps/Ansible/img/b_ansible.png"></div><br></div></div></div></div><br><div class="Content2 GTitle1"><div class="MainBlock2"><div class="Content"><h1 class="Title2 Center" id="Fondamentaux"><a class="Link3" href="#">Fondamentaux</a></h1><div class="Body3"><br><b>Ansible </b>est un outil de gestion automatique de configurations. <b>Python </b>est un langage de programmation orientée objet doté d'un interpréteur de scripts. <b>Pip </b>est un gestionnaire de package Python. <b>Paramiko </b>est un plugin de gestion de connexion. <b>Argcomplete </b>est un outil de gestion d’autocomplétion des arguments de scripts Python. <b>Bash </b>est un interpréteur de scripts sous Linux. <b>SHELL </b>est la variable contenant l'interpréteur en cours sous Linux. <b>Sshpass </b>est un outil de gestion des mots de passe permenttant d'établir une connexion ssh sans demande de mot de passe. <b>/etc/ansible/hosts </b>est le fichier contenant l'inventaire des noeuds à gérer. Un <b>noeud à gérer</b> est une machine n'exécutant pas Ansible. Le <b>nœud de contrôle</b> est la machine exécutant Ansible. Un <b>Playbook </b>est un ensemble de tâches réutilisable configuré dans un fichier Yaml. Yaml est un format de stockage de données. <b>Xml </b>est un format de stockage de données. Une commande <b>Ad-hoc</b> est une commande exécutée ponctuellement. <b>Jinja </b>est un moteur de templates web Python. <b>Geany </b>est un éditeur de texte.<br><br><div class="Content0 GSummary2"><div class="Row26">Summary 2</div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Installer-Ansible-sous-Ubuntu"><a class="Link9" href="#Fondamentaux">Installer Ansible sous Ubuntu</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">python3 -m pip install --user ansible</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Installer-Paramiko-sous-Ubuntu"><a class="Link9" href="#Fondamentaux">Installer Paramiko sous Ubuntu</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">python3 -m pip install --user paramiko</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Installer-Argcomplete-sous-Ubuntu"><a class="Link9" href="#Fondamentaux">Installer Argcomplete sous Ubuntu</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">python3 -m pip install argcomplete
sudo activate-global-python-argcomplete3</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Installer-Sshpass-sous-Ubuntu"><a class="Link9" href="#Fondamentaux">Installer Sshpass sous Ubuntu</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">sudo apt install sshpass</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Installer-Jinja2-sous-Ubuntu"><a class="Link9" href="#Fondamentaux">Installer Jinja2 sous Ubuntu</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="xml">pip install Jinja2</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Installer-Geany-sous-Ubuntu"><a class="Link9" href="#Fondamentaux">Installer Geany sous Ubuntu</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="ini">sudo apt-get install geany</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Afficher-la-version-de-Bash"><a class="Link9" href="#Fondamentaux">Afficher la version de Bash</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">bash --version</pre></div></div><br>La commande <span class="GCode3"><code style="color:#cccccc;">(bash -v)</code></span>&nbsp; crée une erreur d'autocompletion.<br><br><h2 class="Title7 GTitle2" id="Fondamentaux-Corriger-l-erreur-d-autocompletion-Bash"><a class="Link9" href="#Fondamentaux">Corriger l'erreur d'autocomplétion Bash</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">bash +v</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Afficher-l-interpreteur-shell-courant"><a class="Link9" href="#Fondamentaux">Afficher l'interpréteur shell courant</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">echo $SHELL</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Syntaxe-d-un-noeud-a-gerer"><a class="Link9" href="#Fondamentaux">Syntaxe d'un noeud à gérer</a></h2><br>/etc/ansible/hosts<br><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="ini">[pattern]
[address] ansible_ssh_pass=[password] ansible_ssh_user=[username]</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Configurer-un-noeud-a-gerer"><a class="Link9" href="#Fondamentaux">Configurer un noeud à gérer</a></h2><br>/etc/ansible/hosts<br><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="ini">[readydev]
192.168.1.30 ansible_ssh_pass=****** ansible_ssh_user=xxxxxx</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Faire-un-ping-sur-les-noeuds-a-gerer"><a class="Link9" href="#Fondamentaux">Faire un ping sur les noeuds à gérer</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">ansible all -m ping</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Executer-une-commande-sur-les-noeuds-a-gerer"><a class="Link9" href="#Fondamentaux">Exécuter une commande sur les noeuds à gérer</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">ansible all -a "/bin/echo hello"</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Creer-un-Playbook"><a class="Link9" href="#Fondamentaux">Créer un Playbook</a></h2><br>playbook.yaml<br><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="yaml">---
- name: my_playbook
  hosts: all
  tasks:
     - name: my_name
       command: "touch /tmp/ansible_was_here"</pre></div></div><br><br><h2 class="Title7 GTitle2" id="Fondamentaux-Executer-un-Playbook"><a class="Link9" href="#Fondamentaux">Exécuter un Playbook</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">ansible-playbook playbook.yaml</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Convertir-des-donnees-Yaml-en-Xml"><a class="Link9" href="#Fondamentaux">Convertir des données Yaml en Xml</a></h2><br><a class="Link7 GLink1" style="color:lime;" target="_blank" href="https://onlineyamltools.com/convert-yaml-to-xml">https://onlineyamltools.com/convert-yaml-to-xml</a><br><br>Yaml<br><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="yaml">---
- name: my_playbook
  hosts: all
  tasks:
     - name: my_name
       command: "touch /tmp/ansible_was_here"</pre></div></div><br><br>Xml<br><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="xml">&lt;row-0&gt;
  &lt;name&gt;my_playbook&lt;/name&gt;
  &lt;hosts&gt;all&lt;/hosts&gt;
  &lt;tasks&gt;
    &lt;name&gt;my_name&lt;/name&gt;
    &lt;command&gt;touch /tmp/ansible_was_here&lt;/command&gt;
  &lt;/tasks&gt;
&lt;/row-0&gt;</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Syntaxe-d-une-commande-ad-hoc"><a class="Link9" href="#Fondamentaux">Syntaxe d'une commande ad-hoc</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="sh">ansible [pattern] -m [module] -a "[module_options]"</pre></div></div><br><h2 class="Title7 GTitle2" id="Fondamentaux-Appeler-l-interpreteur-Python"><a class="Link9" href="#Fondamentaux">Appeler l'interpréteur Python</a></h2><br><div class="GCode1"><div class="Code2"><pre class="AceCode" data-state="off" data-mode="python">python3</pre></div></div><br><br><br></div></div></div></div><br>